<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leaks</title>
  <link rel="stylesheet" href="/dashboard/new.css">
  <link rel="stylesheet" href="/dashboard/base.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <nav>
        <ul>
          <li><a href="{{ url_for('homepage') }}"><i class="fa-regular fa-house"></i></a></li>
          <li><a href="{{ url_for('dashboard') }}"><i class="fa-regular fa-chart-bar"></i></a></li>
          <li><a href="{{ url_for('resources_route') }}"><i class="fa-regular fa-file"></i></a></li>
          <li><a href="{{ url_for('account') }}"><i class="fa-regular fa-circle-user"></i></a></li>
        </ul>
      </nav>
    </aside>
  <main style="justify-content:center;">
    <div class="section-heading">
      <h2>Leaks</h2>
    </div>
    <section style="width:100%; max-width:1200px; margin:0 auto;">

        <!-- Toolbar: crawler run buttons moved to the top -->
        <div class="dashboard-item" style="margin-bottom:12px;">
          <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
            <button id="runPastebinBtn" class="btn-primary">Run Pastebin</button>
            <input id="pasteLimit" type="number" min="1" max="100" value="10" class="input-compact" />
            <span class="muted">Limit</span>
            <span id="runStatus" class="muted"></span>

            <button id="runGithubBtn" class="btn-primary">Run GitHub</button>
            <input id="githubLimit" type="number" min="1" max="50" value="5" class="input-compact" />
            <span class="muted">Limit</span>
            <span id="githubStatus" class="muted"></span>

            <button id="runTorBtn" class="btn-primary">Fetch via Tor</button>
            <input id="torPort" type="number" placeholder="9150" value="9150" class="input-compact" />
            <span id="torStatus" class="muted"></span>

            <button id="runI2PBtn" class="btn-primary">Fetch via I2P</button>
            <input id="i2pUrl" placeholder="http://zzz.i2p/" class="input-wide" />
            <input id="i2pPort" type="number" placeholder="4444" class="input-compact" />
            <span id="i2pStatus" class="muted"></span>

            <button id="insertMockLeaksBtn" class="btn-secondary">Insert Mock Leaks</button>
            <span id="mockInsertStatus" class="muted"></span>
          </div>
          <div class="muted" style="font-size: 12px; margin-top:6px;">
            Note: Tor requires a local SOCKS proxy (127.0.0.1:9050 or 9150). I2P requires a local HTTP proxy (127.0.0.1:4444).
          </div>
        </div>

        <!-- Tabs: Leaks and Watchlist -->
        <div class="tabs">
          <button class="tab-btn active" data-tab="leaksTab">Leaks</button>
          <button class="tab-btn" data-tab="watchlistTab">Watchlist</button>
        </div>

        <!-- Leaks tab content -->
        <section id="leaksTab" class="tab-content active">
          <div class="align-left-tight" style="display:flex; flex-wrap:wrap; gap:8px; align-items:center; margin:10px 0 12px 0;">
            <select id="srcFilter" title="Source" class="input-compact">
              <option value="">any source</option>
              <option value="pastebin">pastebin</option>
              <option value="github">github</option>
              <option value="tor">tor</option>
              <option value="i2p">i2p</option>
            </select>
            <select id="sevFilter" title="Severity" class="input-compact">
              <option value="">any severity</option>
              <option value="critical">critical</option>
              <option value="high">high</option>
              <option value="medium">medium</option>
              <option value="low">low</option>
              <option value="zero severity">zero severity</option>
              <option value="unknown">unknown</option>
            </select>
            <button id="applyFilters" class="btn-primary">Apply</button>
          </div>
          <div class="pager align-left-tight" id="leaksPagerTop" style="display:flex; align-items:center; gap:10px; margin:6px 0;">
            <button id="prevPage" class="btn-primary" title="Previous" style="padding:4px 10px;">‹</button>
            <span id="pageInfo" class="muted">Showing 0 of 0</span>
            <button id="nextPage" class="btn-primary" title="Next" style="padding:4px 10px;">›</button>
          </div>
          <div class="table-wrap align-left-tight">
            <table class="data" id="leaks-table">
              <thead>
                <tr>
                  <th>Source</th>
                  <th>Title</th>
                  <th>Entities</th>
                  <th>Severity</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="5" class="muted">Loading…</td></tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Watchlist tab content -->
        <section id="watchlistTab" class="tab-content">
          <h3 style="margin-top:0">Watchlist (affects severity)</h3>
          <div class="align-left-tight" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-bottom:8px;">
            <select id="assetType" class="input-compact">
              <option value="email">email</option>
              <option value="domain">domain</option>
              <option value="ip">ip</option>
              <option value="btc">btc</option>
              <option value="ssn">ssn</option>
              <option value="password">password</option>
              <option value="name">name</option>
              <option value="phone">phone</option>
              <option value="address">address</option>
            </select>
            <input id="assetValue" placeholder="value (e.g., user@acme.com or acme.com)" class="input-wide" />
            <button id="addAsset" class="btn-primary">Add</button>
            <span id="assetStatus" class="muted"></span>
          </div>
          <div class="table-wrap align-left-tight">
            <table class="data" id="assets-table">
              <thead>
                <tr>
                  <th>Type</th>
                  <th>Value</th>
                  <th>Added</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="4" class="muted">Loading…</td></tr>
              </tbody>
            </table>
          </div>
        </section>
      </section>
    </main>
  </div>
  <!-- Leak details modal -->
  <div id="leakModal" class="modal-backdrop" style="display:none;">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="leakModalTitle">
      <div class="modal-header">
        <h3 id="leakModalTitle" style="margin:0;">Leak details</h3>
        <button id="leakModalClose" class="btn-primary" style="background:#3D4754;">Close</button>
      </div>
      <div id="leakModalBody" class="modal-body"></div>
    </div>
  </div>
  <script>
    // Persist API key for API calls from JS (used by crawlers/assets endpoints)
    try { if ('{{ api_key or '' }}') { localStorage.setItem('api_key', '{{ api_key or '' }}'); } } catch (e) {}
  </script>
  <script src="{{ url_for('static', filename='js/leaks.js') }}"></script>
</body>
</html>

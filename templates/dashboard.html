<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Homepage with dashboard, resources, and account management for users.">
    <meta name="keywords" content="homepage, dashboard, resources, account, user, web">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/dashboard/base.css">
    <link rel="stylesheet" href="/dashboard/new.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <nav>
                <ul>
                    <li><a href="{{ url_for('homepage') }}" data-tooltip="Home"><i class="fa-regular fa-house"></i></a></li>
                    <li><a href="{{ url_for('leaks') }}" data-tooltip="Leaks"><i class="fa-solid fa-spider"></i></a></li>
                    <li><a href="{{ url_for('alerts') }}" data-tooltip="Alerts"><i class="fa-regular fa-bell"></i></a></li>
                    <li><a class="active" href="{{ url_for('dashboard') }}" data-tooltip="Dashboard"><i class="fa-regular fa-chart-bar"></i></a></li>
                    <li><a href="{{ url_for('reports') }}" data-tooltip="Reports"><i class="fa-regular fa-file-lines"></i></a></li>
                    <li><a href="{{ url_for('resources_route') }}" data-tooltip="Resources"><i class="fa-solid fa-book-open"></i></a></li>
                    <li><a href="{{ url_for('account') }}" data-tooltip="Account"><i class="fa-regular fa-circle-user"></i></a></li>
                    <li><a href="{{ url_for('config') }}" data-tooltip="Settings"><i class="fa-solid fa-gear"></i></a></li>
                </ul>
            </nav>
        </aside>
        <main>
            <div class="section-heading">
                <h2>Dashboard</h2>
            </div>
            <div class="columns">
                <div class="col">
                    <section id="leaks-bar-section" class="chart-section">
                        <h3>Leaks per Crawler</h3>
                        <canvas id="leaksChart" width="300" height="120"></canvas>
                        <div id="leaksChartMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                    <section id="severity-trend-section" class="chart-section">
                        <h3>Risk by Severity Over Time</h3>
                        <canvas id="severityTrendChart" width="400" height="160"></canvas>
                        <div id="severityTrendMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                    <section id="top-assets-section" class="chart-section">
                        <h3>Top Risky Assets</h3>
                        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                            <div style="font-size:0.9em;color:#ddd;">View:</div>
                            <div id="topAssetsToggle" style="display:flex;gap:6px;">
                                <button id="topAssetsToggleType" class="small-toggle active" style="background:#333;color:#fff;border:1px solid #555;padding:6px 8px;border-radius:4px;">By Type</button>
                                <button id="topAssetsToggleAsset" class="small-toggle" style="background:transparent;color:#ddd;border:1px solid transparent;padding:6px 8px;border-radius:4px;">By Asset</button>
                            </div>
                        </div>
                        <canvas id="topAssetsChart" width="400" height="200"></canvas>
                        <div id="topAssetsMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                </div>
                <div class="col">
                    <section id="alerts-line-section" class="chart-section">
                        <h3>Critical Alerts Over Time</h3>
                        <canvas id="alertsChart" width="300" height="120"></canvas>
                        <div id="alertsChartMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                     <section id="risk-trend-section" class="chart-section">
                        <h3>Overall Risk Trend</h3>
                        <canvas id="riskTrendChart" width="300" height="120"></canvas>
                        <div id="riskTrendMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                </div>
                <div class="col">
                    <section id="risk-pie-section" class="chart-section">
                        <h3>Risk Severity Breakdown</h3>
                        <canvas id="riskChart" width="300" height="120"></canvas>
                        <div id="riskChartMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                    <section id="crawl-runs-section" class="dashboard-item">
                        <h2>Crawl Runs</h2>
                        <p>Your recent crawler activity:</p>
                        <div id="crawlRunsMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                        <table id="crawlRunsTable" style="width:100%; border-collapse: collapse; margin-top: 10px; color: white;">
                            <thead>
                            <tr>
                                <th style="border-bottom: 1px solid #555; text-align:left;">Source</th>
                                <th style="border-bottom: 1px solid #555; text-align:left;">Date</th>
                                <th style="border-bottom: 1px solid #555; text-align:left;">Start</th>
                                <th style="border-bottom: 1px solid #555; text-align:left;">Finish</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        </section>

            </div>
        </main>
    </div>
    <script>
        // Inject the user's API key into localStorage on dashboard load
        localStorage.setItem('api_key', "{{ api_key }}");
    </script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>

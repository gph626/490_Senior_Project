<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Homepage with dashboard, resources, and account management for users.">
    <meta name="keywords" content="homepage, dashboard, resources, account, user, web">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/dashboard/new.css">
    <link rel="stylesheet" href="/dashboard/base.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</head>
<body>
    <div class="container">
        <h3 id="user-display">Hello, {{ username }}</h3>
        <aside class="sidebar">
            <nav>
                <ul>
                    <li><a href="{{ url_for('homepage') }}"><i class="fa-regular fa-house"></i></a></li>
                    <li><a class="active" href="{{ url_for('dashboard') }}"><i class="fa-regular fa-chart-bar"></i></a></li>
                    <li><a href="{{ url_for('reports') }}"><i class="fa-regular fa-file"></i></a></li>
                    <li><a href="{{ url_for('resources_route') }}"><i class="fa-solid fa-shield-halved"></i></a></li>
                    <li><a href="{{ url_for('account') }}"><i class="fa-regular fa-circle-user"></i></a></li>
                </ul>
            </nav>
        </aside>
        <main>
            <div class="section-heading">
                <h2>Dashboard</h2>
            </div>
            <div class="columns">
                <div class="col">
                    <section id="dashboard-section">
                        <h2><a href="/dashboard/" style="text-decoration:none;color:inherit;">Dashboard</a></h2>
                        <section class="dashboard-item">
                            <p>Overview and quick stats for your account.</p>
                        </section>
                    </section>
                    <section id="leaks-bar-section" class="chart-section">
                        <h3>Leaks per Crawler</h3>
                        <canvas id="leaksChart" width="300" height="120"></canvas>
                        <div id="leaksChartMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                     <section id="reports-section">
                        <h2><a href="/reports/" style="text-decoration:none;color:inherit;">Reports</a></h2>
                        <section class="reports-item">
                            <p>Reports offer detailed summaries and historical data on security incidents, alerts, and risk assessments. Use reports to track trends, review past events, and support compliance or audit requirements.</p>
                        </section>
                    </section>
                </div>
                <div class="col">
                    <section id="alerts-section">
                        <h2><a href="/alerts/" style="text-decoration:none;color:inherit;">Alerts</a></h2>
                        <section class="alerts-item">
                            <p>Alerts notify you of important security events detected by the system, such as data leaks, suspicious activity, or phishing attempts. Each alert is categorized by severity to help you prioritize your response.</p>
                        </section>
                    </section>
                    <section id="alerts-line-section" class="chart-section">
                        <h3>Critical Alerts Over Time</h3>
                        <canvas id="alertsChart" width="300" height="120"></canvas>
                        <div id="alertsChartMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                </div>
                <div class="col">
                    <section id="risk-analysis-section">
                        <h2><a href="/risk_analysis/" style="text-decoration:none;color:inherit;">Risk Analysis</a></h2>
                        <section class="risk-analysis-item">
                            <p>Risk Analysis provides an assessment of your organization's assets, highlighting potential vulnerabilities and their associated risk levels. This helps you understand and address areas that may require additional security measures.</p>
                        </section>
                    </section>
                    <section id="risk-pie-section" class="chart-section">
                        <h3>Risk Severity Breakdown</h3>
                        <canvas id="riskChart" width="300" height="120"></canvas>
                        <div id="riskChartMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                    </section>
                    <section id="crawl-runs-section" class="dashboard-item">
                        <h2>Crawl Runs</h2>
                        <p>Your recent crawler activity:</p>
                        <div id="crawlRunsMsg" style="color: #ffffff; font-size: 0.9em;"></div>
                        <table id="crawlRunsTable" style="width:100%; border-collapse: collapse; margin-top: 10px; color: white;">
                            <thead>
                            <tr>
                                <th style="border-bottom: 1px solid #555; text-align:left;">ID</th>
                                <th style="border-bottom: 1px solid #555; text-align:left;">Source</th>
                                <th style="border-bottom: 1px solid #555; text-align:left;">Status</th>
                                <th style="border-bottom: 1px solid #555; text-align:left;">Started</th>
                                <th style="border-bottom: 1px solid #555; text-align:left;">Finished</th>
                            </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                        </section>

            </div>
        </main>
    </div>
    <script>
        // Inject the user's API key into localStorage on dashboard load
        localStorage.setItem('api_key', "{{ api_key }}");
    </script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>

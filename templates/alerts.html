<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Alerts for dark web monitoring dashboard.">
    <meta name="keywords" content="alerts, dashboard, security, dark web">
    <title>Alerts</title>

    <link rel="stylesheet" href="/dashboard/new.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.1/css/all.min.css">
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <nav>
                <ul>
                    <li><a href="{{ url_for('homepage') }}" data-tooltip="Home"><i class="fa-regular fa-house"></i></a></li>
                    <li><a href="{{ url_for('leaks') }}" data-tooltip="Leaks"><i class="fa-solid fa-spider"></i></a></li>
                    <li><a class="active" href="{{ url_for('alerts') }}" data-tooltip="Alerts"><i class="fa-regular fa-bell"></i></a></li>
                    <li><a href="{{ url_for('dashboard') }}" data-tooltip="Dashboard"><i class="fa-regular fa-chart-bar"></i></a></li>
                    <li><a href="{{ url_for('reports') }}" data-tooltip="Reports"><i class="fa-regular fa-file-lines"></i></a></li>
                    <li><a href="{{ url_for('config') }}" data-tooltip="Settings"><i class="fa-solid fa-gear"></i></a></li>
                    <li><a href="{{ url_for('resources_route') }}" data-tooltip="Resources"><i class="fa-solid fa-book-open"></i></a></li>
                    <li><a href="{{ url_for('account') }}" data-tooltip="Account"><i class="fa-regular fa-circle-user"></i></a></li>
                </ul>
            </nav>
        </aside>
        <main>
            <div class="section-heading head-and-sub">
                <h2>Alerts & Notifications</h2>
                <nav class="sub-tabs">
                    <ul class="tab-button active" data-tab="critical">Critical Leaks</ul>
                    <ul class="tab-button" data-tab="history">Delivery History</ul>
                    <ul class="tab-button" data-tab="settings">Configuration</ul>
                </nav>
            </div>
            
            <!-- Timer Display -->
            <div class="alert-timer" style="padding: 12px 40px; margin: 0 40px 20px; background: #23272F; border-radius: 8px; color: #9aa2ac; font-size: 14px; text-align: center; border: 1px solid #3D4754;">
                <i class="fa-solid fa-clock"></i> Loading timer...
            </div>
            
            <!-- Professional Tabs Layout -->
            <div style="max-width: 1400px; margin: 0 auto; padding: 0 40px;">
                <!-- <div class="tabs" style="margin-bottom: 30px;">
                    <button class="tab-button active" data-tab="critical">Critical Leaks</button>
                    <button class="tab-button" data-tab="history">Delivery History</button>
                    <button class="tab-button" data-tab="settings">Configuration</button>
                </div> -->
                
                <!-- Critical Leaks Tab -->
                <div id="critical-tab" class="tab-content active">
                    <div style="background: #2e3143; border-radius: 12px; padding: 24px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <h3 style="margin: 0 0 8px 0; color: #ECECEC;">Critical Security Leaks</h3>
                                <p style="margin: 0; color: #9aa2ac; font-size: 14px;">High-severity findings requiring immediate attention (≥70)</p>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <span id="alertsStatus" style="color: #9aa2ac; font-size: 14px;"></span>
                                <button id="refreshAlerts" class="btn-primary">
                                    <i class="fa-solid fa-rotate"></i> Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-wrap">
                            <table id="alertsTable" class="data">
                                <thead>
                                    <tr>
                                        <th style="width: 100px;">Severity</th>
                                        <th style="width: 180px;">Detected</th>
                                        <th style="width: 120px;">Source</th>
                                        <th>Description & Entities</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="4" class="muted" style="text-align: center; padding: 40px;">Loading alerts...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Alert History Tab -->
                <div id="history-tab" class="tab-content">
                    <div style="background: #2e3143; border-radius: 12px; padding: 24px; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <div>
                                <h3 style="margin: 0 0 8px 0; color: #ECECEC;">Webhook Delivery Log</h3>
                                <p style="margin: 0; color: #9aa2ac; font-size: 14px;">Track all webhook notifications sent to your endpoints</p>
                            </div>
                            <div style="display: flex; gap: 12px; align-items: center;">
                                <span id="historyStatus" style="color: #9aa2ac; font-size: 14px;"></span>
                                <button id="refreshHistory" class="btn-primary">
                                    <i class="fa-solid fa-rotate"></i> Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-wrap">
                            <table id="historyTable" class="data">
                                <thead>
                                    <tr>
                                        <th style="width: 100px;">Type</th>
                                        <th style="width: 120px;">Status</th>
                                        <th style="width: 180px;">Sent At</th>
                                        <th style="width: 100px;">Leak ID</th>
                                        <th>Destination</th>
                                        <th style="width: 200px;">Error Details</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr><td colspan="6" class="muted" style="text-align: center; padding: 40px;">Loading history...</td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                
                <!-- Alert Settings Tab -->
                <div id="settings-tab" class="tab-content">
                    <div style="background: #2e3143; border-radius: 12px; padding: 32px; max-width: 800px;">
                        <h3 style="margin: 0 0 8px 0; color: #ECECEC;">Notification Configuration</h3>
                        <p style="margin: 0 0 32px 0; color: #9aa2ac; font-size: 14px;">Configure how and when you receive critical leak alerts</p>
                        
                        <form id="alertSettingsForm">
                            <!-- Enable/Disable Toggle -->
                            <div style="background: #23272F; border-radius: 8px; padding: 20px; margin-bottom: 24px;">
                                <label style="display: flex; align-items: center; cursor: pointer; user-select: none;">
                                    <input type="checkbox" id="alertsEnabled" name="enabled" style="width: 20px; height: 20px; margin-right: 12px; cursor: pointer;">
                                    <div>
                                        <div style="font-weight: 600; color: #ECECEC; margin-bottom: 4px;">Enable Alert Notifications</div>
                                        <div style="font-size: 13px; color: #9aa2ac;">Automatically send webhooks when critical leaks are detected</div>
                                    </div>
                                </label>
                            </div>
                            
                            <!-- Batch Check Interval -->
                            <div id="batchIntervalSection" style="margin-bottom: 24px;">
                                <label style="display: block; font-weight: 600; color: #ECECEC; margin-bottom: 8px;">
                                    <i class="fa-solid fa-clock"></i> Batch Check Interval
                                </label>
                                <input type="number" id="checkInterval" name="check_interval_min" 
                                       placeholder="15" min="5" max="1440" value="15"
                                       style="width: 100%; padding: 12px; background: #23272F; border: 1px solid #3D4754; border-radius: 6px; color: #ECECEC; font-size: 14px;">
                                <small style="display: block; margin-top: 6px; color: #9aa2ac; font-size: 13px;">
                                    <i class="fa-solid fa-circle-info"></i> How often (in minutes) to automatically check for and batch non-alerted leaks (5-1440)
                                </small>
                            </div>
                            
                            <!-- Webhook URL -->
                            <div style="margin-bottom: 24px;">
                                <label style="display: block; font-weight: 600; color: #ECECEC; margin-bottom: 8px;">
                                    <i class="fa-solid fa-link"></i> Webhook URL
                                </label>
                                <input type="url" id="webhookUrl" name="webhook" 
                                       placeholder="https://discord.com/api/webhooks/..." 
                                       style="width: 100%; padding: 12px; background: #23272F; border: 1px solid #3D4754; border-radius: 6px; color: #ECECEC; font-size: 14px;">
                                <small style="display: block; margin-top: 6px; color: #9aa2ac; font-size: 13px;">
                                    <i class="fa-solid fa-circle-info"></i> Discord, Slack, or custom webhook endpoint for JSON POST requests
                                </small>
                            </div>
                            
                            <!-- Alert Threshold -->
                            <div style="margin-bottom: 24px;">
                                <label style="display: block; font-weight: 600; color: #ECECEC; margin-bottom: 8px;">
                                    <i class="fa-solid fa-sliders"></i> Alert Threshold
                                </label>
                                <select id="alertThreshold" name="threshold"
                                        style="width: 100%; padding: 12px; background: #23272F; border: 1px solid #3D4754; border-radius: 6px; color: #ECECEC; font-size: 14px; cursor: pointer;">
                                    <option value="critical">Critical Only (Score ≥ 100) - Only most severe leaks</option>
                                    <option value="high">High & Critical (Score ≥ 75) - Major security risks</option>
                                    <option value="medium">Medium & Above (Score ≥ 50) - Moderate threats</option>
                                    <option value="low">Low & Above (Score ≥ 25) - All suspicious activity</option>
                                </select>
                                <small style="display: block; margin-top: 6px; color: #9aa2ac; font-size: 13px;">
                                    <i class="fa-solid fa-circle-info"></i> <strong>What this means:</strong> Only leaks with severity at or above your threshold will trigger alerts.<br>
                                    <span style="margin-left: 20px;">• <strong>Critical (100+):</strong> Even 1 SSN, password, or credit card number = CRITICAL</span><br>
                                    <span style="margin-left: 20px;">• <strong>High (60-99):</strong> Multiple physical addresses (3+), phone numbers (5+), or bitcoin wallets</span><br>
                                    <span style="margin-left: 20px;">• <strong>Medium (25-59):</strong> Few phone numbers, emails, or IPs detected</span><br>
                                    <span style="margin-left: 20px;">• <strong>Low (5-24):</strong> Minimal suspicious content (domains, names only)</span><br>
                                    <span style="margin-left: 20px; color: #f39c12;">⚠️ Lower thresholds = more frequent notifications</span>
                                </small>
                            </div>
                            
                            <!-- Email (Coming Soon) -->
                            <div style="margin-bottom: 32px; opacity: 0.6;">
                                <label style="display: block; font-weight: 600; color: #ECECEC; margin-bottom: 8px;">
                                    <i class="fa-solid fa-envelope"></i> Email Notifications <span style="background: #3D4754; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: 700; margin-left: 8px;">COMING SOON</span>
                                </label>
                                <input type="email" id="alertEmail" name="email" 
                                       placeholder="alerts@example.com" disabled
                                       style="width: 100%; padding: 12px; background: #1a1d26; border: 1px solid #2a2f36; border-radius: 6px; color: #6b7280; font-size: 14px; cursor: not-allowed;">
                            </div>
                            
                            <!-- Action Buttons -->
                            <div style="display: flex; gap: 12px; padding-top: 24px; border-top: 1px solid #3D4754;">
                                <button type="submit" class="btn-primary" style="flex: 1; padding: 14px; font-size: 15px; font-weight: 600;">
                                    <i class="fa-solid fa-floppy-disk"></i> Save Configuration
                                </button>
                                <button type="button" id="testWebhook" class="btn-secondary" style="padding: 14px 24px; font-size: 15px; font-weight: 600;">
                                    <i class="fa-solid fa-flask"></i> Test Webhook
                                </button>
                                <button type="button" id="testBatchWebhook" class="btn-secondary" style="padding: 14px 24px; font-size: 15px; font-weight: 600;">
                                    <i class="fa-solid fa-layer-group"></i> Test Batch
                                </button>
                            </div>
                            
                            <!-- Status Message -->
                            <div id="settingsStatus" style="margin-top: 16px; padding: 12px; border-radius: 6px; font-size: 14px; display: none;"></div>
                        </form>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <script src="{{ url_for('static', filename='js/alert_timer.js') }}"></script>
    <script src="{{ url_for('static', filename='js/alerts.js') }}"></script>
</body>
</html>
